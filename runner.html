<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Streamer Hunt – Runner View</title>

<style>
html, body, #map {
  width: 100%;
  height: 100%;
  margin: 0;
  background: #000;
}
</style>
</head>
<body>

<div id="map"></div>

<script>
let map;
let hunterMarker;
let lastTimestamp = null;

fetch("api.php?action=config")
  .then(r => r.json())
  .then(cfg => {
    const script = document.createElement("script");
    script.src =
      "https://maps.googleapis.com/maps/api/js?key=" +
      cfg.google_maps_key +
      "&callback=initMap";
    script.async = true;
    document.head.appendChild(script);
  });

function initMap() {
  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: 0, lng: 0 },
    zoom: 16,
    disableDefaultUI: true
  });

  hunterMarker = new google.maps.Marker({
  map: null,
  icon: {
    path: "M -10,0 L 10,0 M 0,-10 L 0,10",
    strokeColor: "#FF0000",   // blau für Hunter
    strokeWeight: 3
  }
});


  pollHunterSnapshot();
  setInterval(pollHunterSnapshot, 3000);
}

function pollHunterSnapshot() {
  fetch("api.php?action=hunter_snapshot&_=" + Date.now())
    .then(r => r.json())
    .then(snap => {
      if (!snap || !snap.lat) return;

      if (snap.timestamp === lastTimestamp) return;
      lastTimestamp = snap.timestamp;

      const pos = { lat: snap.lat, lng: snap.lng };
      hunterMarker.setPosition(pos);
      hunterMarker.setMap(map);

      map.setCenter(pos);
      map.setZoom(18);
    });
}
</script>

</body>
</html>
